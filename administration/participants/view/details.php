<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'administration/includes/auth.php';/* objects. */require_once 'class/participant.php';require_once 'class/participantcategory.php';$participantObject 					= new class_participant();$participantcategoryObject 	= new class_participantcategory();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$participantData = $participantObject->getByCode($code);		if($participantData) {		$smarty->assign('participantData', $participantData);	} else {		header('Location: /administration/participants/view/');		exit;			}}$categorypairs = $participantcategoryObject->pairs();if($categorypairs) $smarty->assign('categorypairs', $categorypairs);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		if(isset($_POST['participantcategory_code']) && trim($_POST['participantcategory_code']) == '') {		$errorArray['participantcategory_code'] = 'required';		$formValid = false;			}		if(isset($_POST['participant_name']) && trim($_POST['participant_name']) == '') {		$errorArray['participant_name'] = 'required';		$formValid = false;			}		if(isset($_POST['participant_surname']) && trim($_POST['participant_surname']) == '') {		$errorArray['participant_surname'] = 'required';		$formValid = false;			}		if(isset($_POST['participant_email']) && trim($_POST['participant_email']) != '') {		if($participantObject->validateEmail(trim($_POST['participant_email'])) == '') {			$errorArray['participant_email'] = 'Needs to be an email address';			$formValid = false;			} else {						$username = isset($participantData) ? $participantData['participant_code'] : null;						$emailData = $participantObject->getByEmail(trim($_POST['participant_email']), $username);						if($emailData) {				$errorArray['participant_email'] = 'Email already exists';				$formValid = false;							}		}	} else {		$errorArray['participant_email'] = 'required';		$formValid = false;				}		if(isset($_POST['participant_cellphone']) && trim($_POST['participant_cellphone']) != '') {		if($participantObject->validateCell(trim($_POST['participant_cellphone'])) == '') {			$errorArray['participant_cellphone'] = 'Needs to be a valid cell number';			$formValid = false;			} else {						$username = isset($participantData) ? $participantData['participant_code'] : null;						$emailData = $participantObject->getByCell(trim($_POST['participant_cellphone']), $username);						if($emailData) {				$errorArray['participant_cellphone'] = 'Cell already exists';				$formValid = false;							}		}	}		if(isset($_POST['participant_telephone']) && trim($_POST['participant_telephone']) != '') {		if($participantObject->validateCell(trim($_POST['participant_telephone'])) == '') {			$errorArray['participant_telephone'] = 'Needs to be a valid cell telephone';			$formValid = false;			}	}		if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();						$data['area_code']							= trim($_POST['area_code']);				$data['participant_name']				= trim($_POST['participant_name']);				$data['participant_surname']			= trim($_POST['participant_surname']);				$data['participant_cellphone']			= $participantObject->validateCell(trim($_POST['participant_cellphone']));				$data['participant_telephone']			= $participantObject->validateCell(trim($_POST['participant_telephone']));				$data['participant_email']				= $participantObject->validateEmail(trim($_POST['participant_email']));			$data['participantcategory_code']	= trim($_POST['participantcategory_code']);		$data['participant_gender']				= trim($_POST['participant_gender']);						if(isset($participantData)) {					/*Update. */			$where		= $participantObject->getAdapter()->quoteInto('participant_code = ?', $participantData['participant_code']);			$success	= $participantObject->update($data, $where);									$success 	= $participantData['participant_code'];		} else {			$success = $participantObject->insert($data);			/*			$_commsObject = new class_comms();						$_commsObject->sendEmailComm('mailers/web/registration_confirm.html', $data, 'Business Lounge Registration Confirmation', array('email' => 'info@bizlounge.co.za', 'name' => 'Business Lounge Information'));			*/		}				if(count($errorArray) == 0) {			header('Location: /administration/participants/view/tickets.php?code='.$success);				exit;				}					}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('administration/participants/view/details.tpl');?>